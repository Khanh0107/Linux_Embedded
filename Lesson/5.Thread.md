# Thread
---
## 1. Overview 

Threads are execution units within a process that enable concurrent task execution. Similar to processes, threads allow multi-tasking but with lower overhead in memory and CPU usage. In a multi-core system, multiple threads can run in parallel, improving performance. If one thread is blocked, others can continue executing independently.


**Benefits:**

Concurrency: Perform multiple tasks at once (e.g., downloading while updating UI).
Responsiveness: UI remains responsive while background work runs.
Performance: On multi-core CPUs, threads can run in parallel.

--- 

## 2. Principle of operation

Similar to processes, threads are created for the purpose of handling multiple tasks at the same time (multi-task).

- A thread is a lightweight process that can be managed independently by a scheduler.
- On a multi-core system. Multiple threads can run in parallel.
- If one thread is blocked, the other threads can continue to run normally.
- Each time a thread is created, it is placed in a stack segment.

**Context Switching** 

The CPU switches between threads, allowing multiple tasks to proceed concurrently. This involves saving and restoring thread states, leading to some overhead.

---

## 3. Compare Process with Thread

**Thread Switching**

Thread switching is a type of context switching from one thread to another thread in the same process.

Thread switching is very efficient and much cheaper because it involves switching out only identities and resources such as the program counter, registers and stack pointers. 

The cost of thread-to-thread switching is about the same as the cost of entering and exiting the kernel.

**Process Switching**

Process switching is a type of context switching where we switch one process with another process. 

 It involves switching of all the process resources with those needed by a new process. 
 
This means switching the memory address space. This includes memory addresses, page tables, and kernel resources, caches in the processor. 

| **Aspect**            | **Thread**                                                            | **Process**                                                             |
| --------------------- | --------------------------------------------------------------------- | ----------------------------------------------------------------------- |
| **Definition**        | Smallest unit of execution within a process                           | Independent program in execution                                        |
| **Memory**            | Shares memory space with other threads of the same process            | Has its own separate memory space                                       |
| **Communication**     | Faster – via shared memory (no IPC needed)                            | Slower – requires Inter-Process Communication (IPC) like pipes, sockets |
| **Creation Overhead** | Low – faster to create                                                | High – more resources and time needed                                   |
| **Context Switching** | Faster – less overhead (threads share resources)                      | Slower – involves switching entire memory context                       |
| **Crash Impact**      | If one thread crashes, it can affect the whole process                | If a process crashes, other processes are usually unaffected            |
| **Control**           | Controlled by the parent process                                      | Managed independently by the OS                                         |
| **Use Case**          | Lightweight tasks within the same app (e.g. UI thread, worker thread) | Independent apps (e.g. Chrome, Word, Calculator)                        |

---

## 4. Working with thread

### 4.1 Thread ID

A process is identified by a process ID, a thread within a process is identified by a thread ID. 

- A process ID is unique across the system, whereas a thread ID is unique within a process. 
- A process ID is an integer value, but a thread ID does not have to be an integer value. It can be a structure. 
- A process ID can be printed very easily, whereas a thread ID cannot.

Thread ID will be represented by the type `pthread_t`. 

In most cases thread ID will be a structure so to compare two thread IDs we need a function that can do this job (For process ID is an integer, the comparison is simpler). 

To do this we use the following two functions: `pthread_self()` and `pthread_equal()`

- `pthread_self()`: Retrieves the calling thread's ID.
  
- `pthread_equal()`: Compares two thread IDs.

### 4.2 Create thread 

`int pthread_create(pthread_t *thread, const pthread_attr_t *attr, void *(*start_routine)(void *),void *arg);`

| **Parameter**                    | **Description**                                                                                            |
| -------------------------------- | ---------------------------------------------------------------------------------------------------------- |
| `pthread_t *thread`              | Output: stores the **ID** of the newly created thread.                                                     |
| `const pthread_attr_t *attr`     | Optional. If `NULL`, default attributes are used (joinable, etc.). Otherwise, custom thread attributes.    |
| `void *(*start_routine)(void *)` | Function pointer – the **function the new thread will run**. It must take a `void *` and return `void *`.  |
| `void *arg`                      | Argument passed to `start_routine`. Can be `NULL` or a pointer to any data you want to pass to the thread. |


`pthread_join()` 

Waits for a specific thread to finish.

It blocks the calling thread until the target thread terminates.

| Parameter          | Description                                                                                                   |
| ------------------ | ------------------------------------------------------------------------------------------------------------- |
| `pthread_t thread` | The thread ID (returned from `pthread_create()`) that you want to wait for.                                   |
| `void **retval`    | A pointer to a `void*` where the return value from the thread will be stored. If you don’t care, pass `NULL`. |

**Code demo**

```c
#include <pthread.h>
#include <stdio.h>
void *thread_function(void *arg) {
    pthread_t tid = pthread_self();
    printf("Thread ID: %lu\n", (unsigned long)tid);
    return NULL;
}
int main() {
    pthread_t thread1, thread2;
    pthread_create(&thread1, NULL, thread_function, NULL);
    pthread_create(&thread2, NULL, thread_function, NULL);
    pthread_join(thread1, NULL);
    pthread_join(thread2, NULL);
    return 0;
}
```

**Output**

```sh
Thread ID: 130023310751296
Thread ID: 130023302358592
```


  
