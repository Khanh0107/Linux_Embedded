# Character device driver

## 1 Introduction

### 1.1. What is driver device

- A device driver is a piece of software in the kernel that lets user-space applications interact with hardware devices.
- In Linux, devices are represented as special files under /dev. Applications just use system calls like open(), read(), write(), ioctl(), and the kernel routes them to the correct driver.

### 1.2. Device Types in Linux

1 Character devices → Data is transferred as a stream of bytes (like a file).
  - Examples: serial ports (/dev/ttyS0), keyboards, mice, LEDs.
2. Block devices → Data is transferred in fixed-size blocks.
  - Examples: hard disks (/dev/sda).
3. Network devices → Managed through the networking stack (not through /dev).

[bootlin](https://elixir.bootlin.com/linux/v6.16.5/source)  opens the source view mode, allowing you to browse the entire source code of the Linux kernel

### 1.3. Major and Minor Numbers

- Linux uses device numbers to identify devices:
  - Major number → identifies the driver.
  - Minor number → identifies the specific device handled by that driver.

**Example:**

```sh
crw-rw-rw- 1 root root 1, 3 Sep  7 11:00 /dev/null
```

- c → character device
- 1 → major number
- 3 → minor number

### 1.4. Commonly used commands

- `uname -r`
  - `uname -r` is a Linux/Unix shell command that prints the kernel release version of your operating system

<img width="203" height="36" alt="image" src="https://github.com/user-attachments/assets/de066153-701f-4aef-bdf5-9c443034dda1" />


- `ls -l /lib/module/`
  - This lists all the installed Linux kernel versions on your system.

- `ls -l /lib/modules/$(uname -r)/build/`
  - This is usually a symbolic link to the directory where the kernel headers or kernel source for that kernel are located in current version

- `sudo insmod exam.ko`
  - It loads the kernel module file (exam.ko) into the running kernel.
  - .ko = “kernel object” file (the compiled module).

- `sudo rmmod exam`
  - rmmod = remove module.
  - It unloads the kernel module exam from the kernel.

- `dmesg -w`
  - dmesg = display message. It shows the kernel log buffer.
  - -w = watch mode, it keeps printing messages as they appear (like tail -f).

<img width="1205" height="430" alt="image" src="https://github.com/user-attachments/assets/9dfc8e45-dbe7-42be-96cd-8f7fcc915b29" />

## 2. Example

### 2.1. Init Exit

[Source code](../Assignments/12_Character_device_driver/Example1/exam.c)

- Output :

<img width="1230" height="432" alt="image" src="https://github.com/user-attachments/assets/8162b2a1-1ae8-4c30-b4fd-67757bd136bc" />

### 2.2 Major minor number 

[Source code](../Assignments/12_Character_device_driver/Example2/exam.c)

- Output :

<img width="1229" height="436" alt="image" src="https://github.com/user-attachments/assets/99b599c0-9771-4f6d-b154-0e7513c78943" />

### 2.3 Device file

[Source code](../Assignments/12_Character_device_driver/Example3/exam.c) 

- Output:

<img width="1230" height="430" alt="image" src="https://github.com/user-attachments/assets/f82f9ad0-5b10-4468-9bf8-324920db7c8c" />

### 2.4 On userspace contact file operation in device driver

[exam.c](../Assignments/12_Character_device_driver/Example4/exam.c)
[testapp.c](../Assignments/12_Character_device_driver/Example4/testapp.c)

**Note:** sudo chmod 666 /dev/m_device

- Output:

<img width="1055" height="553" alt="image" src="https://github.com/user-attachments/assets/fdfd24a8-fb86-439c-a2ba-ede40faf6f0d" />


